#!/bin/zsh
setopt localoptions extendedglob

if ! zle .undo && [[ -z $BUFFER ]] && (( ZLE_RECURSIVE == 0 )); then
  local reply
  hist -fs d -1
  LBUFFER+=$reply[2]
  UNDO_LIMIT_NO=$UNDO_CHANGE_NO
fi
